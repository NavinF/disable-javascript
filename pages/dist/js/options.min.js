'use strict';var browser=browser,promises=!0;function domContentLoaded(){var i=[{label:'Default state',name:'default_state',type:'radio',options:[{label:'JS on',value:'on'},{label:'JS off',value:'off'}]},{label:'Disable behavior',name:'disable_behavior',type:'radio',options:[{label:'By domain',value:'domain'},{label:'By tab',value:'tab'}]},{label:'Enable shortcuts',details:'(<a href="about.html">More information</a>)',name:'shortcuts',type:'radio',options:[{label:'Yes',value:'true'},{label:'No',value:'false'}]},{label:'Enable context menu item',name:'context_menu',type:'radio',options:[{label:'Yes',value:'true'},{label:'No',value:'false'}]}],m='setting-',t=document.getElementById('add-domain-form-modal'),e=document.getElementById('add-domain-form'),o=document.getElementById('add-domain-form__domain-name'),a=document.getElementById('add-domain-form-modal__close'),n=document.getElementById('add-domain-form__include-sub-domains'),l=' <span class="version">(v'+browser.runtime.getManifest().version+')</span>';function r(e){var a=document.getElementById('domain-list--tbody'),t='',o=!1,n=[],l=document.getElementById('search');for(var r in e)r.startsWith(m)||(n.push(r),o=!0);for(var s=n.length-1;0<=s;s--){var d,i=!1;'string'==typeof e[r=n[s]]?d=new Date(e[r]):(d=new Date(e[r].date),i=e[r]['include-subdomains']),t+='<tr>',t+='<td>'+r+'</td>',t+='<td>'+d.toLocaleDateString()+' '+d.toLocaleTimeString()+'</td>',t+='<td>'+(i?'Yes':'No')+'</td>',t+='</tr>'}0===t.length?(t+='<tr>',t+='<td class="empty" colspan="3">You have not added any domains to your white-/blacklist yet.</td>',t+='</tr>',l.disabled=!0):l.disabled=!1,a.innerHTML=t;var c=a.querySelectorAll('tr');for(s=0;s<c.length;s++)c[s].addEventListener('click',function(){if(this.classList.contains('active'))this.classList.remove('active');else{for(var e=a.querySelectorAll('tr.active'),t=0;t<e.length;t++)e[t].classList.remove('active');this.classList.add('active'),document.getElementById('remove').disabled=!1}});o&&(document.getElementById('remove-all').disabled=!1)}function s(e){'domain'===e[m+'disable_behavior']?(document.body.classList.remove('disable-behavior--tab'),promises?browser.storage.local.get().then(r):browser.storage.local.get(r)):document.body.classList.add('disable-behavior--tab')}function d(){document.getElementById('remove').disabled=!0,document.getElementById('remove-all').disabled=!0,promises?browser.storage.local.get(m+'disable_behavior').then(s):browser.storage.local.get(m+'disable_behavior',s)}function c(){t.style.display='none'}function u(){var e={},t=this.value;switch(this.value){case'true':t=!0;break;case'false':t=!1}e[m+this.name]=t,browser.storage.local.set(e),browser.runtime.sendMessage({type:this.name,value:t}),d()}function v(e){for(var t='',a=0;a<i.length;a++){var o=i[a];t+='<tr>',t+='<td><label>'+o.label+'</label><span>','details'in o&&(t+=o.details),t+='</span></td><td>';for(var n=0;n<i[a].options.length;n++){var l=o.options[n],r=o.name+'-'+l.value,s='';e[m+o.name]===l.value?s=' checked="checked"':!0===e[m+o.name]&&'true'===l.value?s=' checked="checked"':!1===e[m+o.name]&&'false'===l.value&&(s=' checked="checked"'),t+='<input type="'+o.type+'" name="'+o.name+'" id="'+r+'" value="'+l.value+'"'+s+' />',t+='<label for="'+r+'">'+l.label+'</label>'}t+='</td>',t+='</tr>'}document.getElementById('settings').innerHTML=t;var d=document.querySelectorAll('input[type=radio]');for(a=0;a<d.length;a++)d[a].addEventListener('click',u)}for(var b=document.querySelectorAll('input[type=button]'),g=0;g<b.length;g++)switch(b[g].id){case'remove':case'remove-all':b[g].disabled=!0}!function(){for(var e=[],t=0;t<i.length;t++)e.push(m+i[t].name);promises?browser.storage.local.get(e).then(v):browser.storage.local.get(e,v)}(),d(),document.getElementById('remove').addEventListener('click',function(){for(var e=document.querySelectorAll('#domain-list--tbody tr.active'),t=0;t<e.length;t++){var a=e[t].childNodes[0].innerHTML;promises?browser.storage.local.remove(a).then(d):browser.storage.local.remove(a,d)}}),document.getElementById('remove-all').addEventListener('click',function(){if(confirm('Are you sure to clear your domain list?')){for(var e={},t=0;t<i.length;t++){var a=i[t].name,o=document.querySelector('input[name="'+a+'"]:checked').value;e[m+a]=o}var n=browser.runtime.getManifest();e['setting-version']=n.version,promises?browser.storage.local.clear().then(function(){browser.storage.local.set(e).then(function(){d()})}):browser.storage.local.clear(function(){browser.storage.local.set(e,function(){d()})})}}),document.getElementById('add-domain').addEventListener('click',function(){e.reset(),t.style.display='block',o.focus()}),e.addEventListener('submit',function(e){e.preventDefault();var t=o.value;if(!/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$/.test(t))return o.setCustomValidity('Please enter a valid host'),!1;var a={};return a[t]={date:(new Date).toISOString()},n.checked&&(a[t]['include-subdomains']=!0),promises?browser.storage.local.set(a).then(function(){d(),c()}):browser.storage.local.set(a,function(){d(),c()}),!1}),o.addEventListener('change',function(){this.setCustomValidity('')}),a.addEventListener('click',c),document.getElementById('search').value='',document.getElementById('search').addEventListener('keyup',function(){for(var e=document.getElementById('domain-list--tbody').getElementsByTagName('tr'),t=0;t<e.length;t++){var a=e[t].getElementsByTagName('td')[0];a&&(-1<a.innerHTML.toUpperCase().indexOf(this.value.toUpperCase())?e[t].style.display='':e[t].style.display='none')}}),window.addEventListener('click',function(e){void 0!==e&&e.target===t&&c()}),document.getElementById('page-title').innerHTML+=l}void 0===browser&&(browser=chrome,promises=!1),document.addEventListener('DOMContentLoaded',domContentLoaded);